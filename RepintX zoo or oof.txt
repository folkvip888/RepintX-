-- ========= LOAD X2ZU UI =========
local Library = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/x2zu/OPEN-SOURCE-UI-ROBLOX/refs/heads/main/X2ZU%20UI%20ROBLOX%20OPEN%20SOURCE/DummyUi-leak-by-x2zu/fetching-main/Tools/Framework.luau"
))()

local Window = Library:Window({
    Title = "RepintX — Zoo or oof",
    Desc  = "ESP / Teleport / Webhook / WalkSpeed",
    Icon  = 105059922903197,
    Theme = "Dark",
    Config = { Keybind = Enum.KeyCode.LeftControl, Size = UDim2.new(0, 560, 0, 420) },
    CloseUIButton = { Enabled = true, Text = "x2zu" }
})

-- ========= SERVICES =========
local Players      = game:GetService("Players")
local Teams        = game:GetService("Teams")
local RunService   = game:GetService("RunService")
local HttpService  = game:GetService("HttpService")
local UserInput    = game:GetService("UserInputService")

local localPlayer  = Players.LocalPlayer

-- ========= CONFIG =========
local ENEMY_COLOR      = Color3.fromRGB(255, 60, 60)
local TP_HEIGHT_OFFSET = 5
local NEAR_DISTANCE    = 10
local CHECK_INTERVAL   = 0.30

-- ========= TELEPORT =========
local function getTeleportTarget()
    local ok, node = pcall(function()
        local f = workspace:WaitForChild("Lobby", 5)
        if not f then return nil end
        f = f:WaitForChild("Lobby", 5)
        if not f then return nil end
        local c = f:WaitForChild("Collision", 5)
        if not c then return nil end
        local children = c:GetChildren()
        return children[15]
    end)
    if not ok or not node then return nil end
    return node
end

local function computeTargetCFrame(target)
    if not target then return nil end
    if target:IsA("BasePart") then
        return target.CFrame + Vector3.new(0, TP_HEIGHT_OFFSET, 0)
    elseif target:IsA("Model") then
        return target:GetPivot() + Vector3.new(0, TP_HEIGHT_OFFSET, 0)
    else
        local part = target:FindFirstChildWhichIsA("BasePart", true)
        if not part then return nil end
        return part.CFrame + Vector3.new(0, TP_HEIGHT_OFFSET, 0)
    end
end

local function doTeleport()
    if not localPlayer.Character then return false,"no char" end
    local hrp = localPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return false,"no hrp" end
    local target = getTeleportTarget()
    if not target then return false,"no target" end
    local cf = computeTargetCFrame(target)
    if not cf then return false,"no cf" end
    if (hrp.Position - cf.Position).Magnitude <= NEAR_DISTANCE then return false,"already near" end
    hrp.CFrame = cf
    return true
end

local function isAnimalTeam()
    if not localPlayer.Team then return false end
    local t = Teams:FindFirstChild("Animal")
    return (t and localPlayer.Team == t) or (localPlayer.Team.Name == "Animal")
end

-- ========= ESP =========
local function clearESPForCharacter(char)
    if not char then return end
    if char:FindFirstChild("Highlight") then char.Highlight:Destroy() end
    if char:FindFirstChild("NameBillboard") then char.NameBillboard:Destroy() end
end

local function setESPForPlayer(p)
    if not p.Character or not p.Character:FindFirstChild("Head") then return end
    local hl = p.Character:FindFirstChildOfClass("Highlight") or Instance.new("Highlight")
    hl.Name = "Highlight"
    hl.FillColor = ENEMY_COLOR
    hl.OutlineColor = Color3.new(1,1,1)
    hl.FillTransparency = 0.5
    hl.Adornee = p.Character
    hl.Parent = p.Character

    local bb = p.Character:FindFirstChild("NameBillboard")
    if not bb then
        bb = Instance.new("BillboardGui")
        bb.Size = UDim2.new(0,160,0,36)
        bb.StudsOffset = Vector3.new(0,2.25,0)
        bb.AlwaysOnTop = true
        bb.MaxDistance = 300
        bb.Name = "NameBillboard"
        bb.Parent = p.Character
    end
    bb.Adornee = p.Character.Head

    local tl = bb:FindFirstChildOfClass("TextLabel")
    if not tl then
        tl = Instance.new("TextLabel")
        tl.Size = UDim2.new(1,0,1,0)
        tl.BackgroundTransparency = 1
        tl.TextScaled = true
        tl.TextStrokeTransparency = 0
        tl.Parent = bb
    end
    tl.Text = p.Name
    tl.TextColor3 = ENEMY_COLOR
end

local function isEnemy(p) return localPlayer.Team and p.Team and (p.Team ~= localPlayer.Team) end
local function updateESPOnce()
    for _,p in ipairs(Players:GetPlayers()) do
        if p ~= localPlayer then
            if isEnemy(p) then setESPForPlayer(p) else clearESPForCharacter(p.Character) end
        end
    end
end

-- ========= UI =========
local TabMain = Window:Tab({ Title="Main", Icon="star" })
local TabHook = Window:Tab({ Title="Webhook", Icon="tag" })
local TabSet  = Window:Tab({ Title="Settings", Icon="wrench" })
Window:Line()

-- Status
local StatusBlock = TabMain:Code({ Title="Status", Code="Status: Ready\nRole: -" })
local function setStatus(text)
    local role = (localPlayer.Team and localPlayer.Team.Name) or "-"
    StatusBlock:SetCode(("Status: %s\nRole: %s"):format(text, role))
end

-- ESP Toggle
local espEnabled, espConn = false,nil
TabMain:Toggle({
    Title="ESP Highlight",
    Desc="ไฮไลท์ศัตรู + ป้ายชื่อ",
    Value=false,
    Callback=function(v)
        espEnabled = v
        if v then
            updateESPOnce()
            if espConn then espConn:Disconnect() end
            espConn = RunService.RenderStepped:Connect(function()
                if (time()%0.25)<1/60 then updateESPOnce() end
            end)
            Window:Notify({Title="ESP",Desc="ON",Time=2})
        else
            if espConn then espConn:Disconnect(); espConn=nil end
            for _,p in ipairs(Players:GetPlayers()) do if p~=localPlayer then clearESPForCharacter(p.Character) end end
            Window:Notify({Title="ESP",Desc="OFF",Time=2})
        end
    end
})

-- Teleport Now
TabMain:Button({
    Title="Teleport Now",
    Desc="วาร์ปทันที (Animal only)",
    Callback=function()
        if not isAnimalTeam() then setStatus("Not Animal"); return end
        local ok,why = doTeleport()
        if ok then setStatus("Teleported manual") else setStatus("Fail: "..why) end
    end
})

-- Auto Teleport Animal only
local autoTP=false; local loopConn=nil
TabMain:Toggle({
    Title="Teleport Animal only (auto)",
    Desc="วาร์ปตลอดเวลาที่เป็น Animal",
    Value=false,
    Callback=function(v)
        autoTP = v
        if v then
            if loopConn then loopConn:Disconnect(); loopConn=nil end
            local acc=0
            loopConn = RunService.Heartbeat:Connect(function(dt)
                acc+=dt; if acc<CHECK_INTERVAL then return end; acc=0
                if not autoTP or not isAnimalTeam() then return end
                local ok,why = doTeleport()
                if ok then setStatus("Teleported auto") elseif why~="already near" then setStatus("AutoTP fail:"..why) end
            end)
        else
            if loopConn then loopConn:Disconnect(); loopConn=nil end
            setStatus("AutoTP OFF")
        end
    end
})

-- ========= WEBHOOK =========
local state={url="",interval="60s"}
local function parseInterval(str)
    str=tostring(str or ""):lower():gsub("%s+","")
    local n=tonumber(str)
    if n then return n end
    local num,unit=str:match("^(%d+)([smh])$")
    num=tonumber(num)
    if num and unit=="s" then return num end
    if num and unit=="m" then return num*60 end
    if num and unit=="h" then return num*3600 end
    return 60
end

local function validUrl(u) return typeof(u)=="string" and u:match("^https?://discord%.com/api/webhooks/") end
local function currentStats()
    local wins,cash=0,0
    local ls=localPlayer:FindFirstChild("leaderstats")
    if ls then
        local w=ls:FindFirstChild("🏆Wins") or ls:FindFirstChild("Wins")
        local c=ls:FindFirstChild("💸Cash") or ls:FindFirstChild("Cash") or ls:FindFirstChild("Coins")
        if w then wins=w.Value end
        if c then cash=c.Value end
    end
    return wins,cash
end

local function makePayload()
    local wins,cash=currentStats()
    local role=(localPlayer.Team and localPlayer.Team.Name) or "N/A"
    return {
        username="RepintX",
        embeds={{color=10971374,
            fields={
                {name="Player",value=localPlayer.Name,inline=true},
                {name="Role",value=role,inline=true},
                {name="Wins",value=tostring(wins),inline=true},
                {name="Cash",value=tostring(cash),inline=true}
            }
        }}
    }
end

local function sendWebhookOnce(url)
    if not validUrl(url) then Window:Notify({Title="Webhook",Desc="Invalid URL",Time=2}); return end
    local data=HttpService:JSONEncode(makePayload())
    local headers={["Content-Type"]="application/json"}
    local requestFunc=http_request or request or syn and syn.request
    if requestFunc then
        requestFunc({Url=url,Method="POST",Headers=headers,Body=data})
        Window:Notify({Title="Webhook",Desc="Sent",Time=2})
    else
        HttpService:PostAsync(url,data,Enum.HttpContentType.ApplicationJson)
    end
end

TabHook:Textbox({
    Title="Webhook URL",Value="",Placeholder="https://discord.com/api/webhooks/...",
    Callback=function(text) state.url=text end
})
TabHook:Textbox({
    Title="Interval",Value="60s",Placeholder="เช่น 30s, 2m, 1h",
    Callback=function(text) state.interval=text end
})
local autoSend=false; local token=0
TabHook:Toggle({
    Title="Auto Send",Value=false,
    Callback=function(v)
        autoSend=v; token+=1; local my=token
        if v then
            task.spawn(function()
                while autoSend and my==token do
                    sendWebhookOnce(state.url)
                    local waitSec=parseInterval(state.interval)
                    for i=1,waitSec do if not autoSend or my~=token then return end; task.wait(1) end
                end
            end)
        end
    end
})
TabHook:Button({
    Title="Send Now",Callback=function() sendWebhookOnce(state.url) end
})

-- ========= SETTINGS =========
local walkspeed=16
TabSet:Slider({
    Title="WalkSpeed",Min=16,Max=100,Value=16,
    Callback=function(val)
        walkspeed=val
        if localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Humanoid") then
            localPlayer.Character:FindFirstChildOfClass("Humanoid").WalkSpeed=val
        end
    end
})

local noclip=false
TabSet:Toggle({
    Title="NoClip",Value=false,
    Callback=function(v)
        noclip=v
    end
})

RunService.Stepped:Connect(function()
    if noclip and localPlayer.Character then
        for _,part in pairs(localPlayer.Character:GetDescendants()) do
            if part:IsA("BasePart") and part.CanCollide then
                part.CanCollide=false
            end
        end
    end
end)

Window:Notify({Title="RepintX",Desc="UI Loaded. LeftCtrl to toggle.",Time=4})
