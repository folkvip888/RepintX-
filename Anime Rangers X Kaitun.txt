--========== RepintX ARX - Main Loader (+ Auto-Boot) ==========--

-- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ config ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å ‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡∏µ‡∏ü‡∏≠‡∏•‡∏ï‡πå‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
if type(_G.TekkitConfig) ~= "table" then
  _G.TekkitConfig = {
    ["AutoPlay"] = false, ["Auto Vote Start Game"] = false, ["Auto Upgrade"] = false,
    ["Auto Vote Next"] = false, ["Auto Replay"] = false, ["Auto Leave"] = false,
    ["Player Only"] = false, ["Speed Gamepass Tier"] = 1, ["Auto Use Speed"] = false,
    ["Webhook URL"] = "",
  }
end

-- ---- fetch + run main script from GitHub (robust) ----
local MAIN_URL = "https://raw.githubusercontent.com/folkvip888/RepintX-/refs/heads/main/New%20Text%20Document.txt"

local function fetch(url)
  local ok, res = pcall(function() return game:HttpGet(url, true) end)
  if not ok or not res or res == "" then return nil end
  local head = res:sub(1,200):lower()
  if head:find("<!doctype") or head:find("<html") then return nil end
  return res
end

local src = fetch(MAIN_URL) or fetch(MAIN_URL .. "?t=" .. os.time())
if not src then return warn("[RepintX Loader] cannot fetch main script") end
src = src:gsub("^\239\187\191","") -- strip UTF-8 BOM if present

local fn, cerr = loadstring(src)
if not fn then return warn("[RepintX Loader] compile error: "..tostring(cerr)) end
local ok, rerr = pcall(fn)
if not ok then warn("[RepintX Loader] runtime error: "..tostring(rerr)) end

-- ---- Auto-Boot enforcer: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏ï‡∏≤‡∏° _G.TekkitConfig ----
task.defer(function()
  local RS = game:GetService("ReplicatedStorage")
  local Players = game:GetService("Players")
  local TeleportService = game:GetService("TeleportService")
  local LocalPlayer = Players.LocalPlayer

  local Remote   = RS:WaitForChild("Remote")
  local R_Server = Remote:WaitForChild("Server")
  local R_OnGame = R_Server:WaitForChild("OnGame")
  local R_Voting = R_OnGame:WaitForChild("Voting")
  local R_Units  = R_Server:WaitForChild("Units")

  local function Cfg(k, d) local t=_G.TekkitConfig or {}; return t[k]==nil and d or t[k] end
  local function clamp(n,a,b) if n<a then return a elseif n>b then return b else return n end end

  _G.__RepintXLoops = _G.__RepintXLoops or {}
  local loops = _G.__RepintXLoops
  local function startOnce(key, runner)
    if loops[key] then return end
    loops[key] = true
    task.spawn(function()
      local ok2, e = pcall(runner)
      if not ok2 then warn("[AutoBoot:"..key.."] "..tostring(e)) end
      loops[key] = nil
    end)
  end

  -- AutoPlay (trigger)
  if Cfg("AutoPlay", false) then
    pcall(function() R_Units:WaitForChild("AutoPlay"):FireServer() end)
  end

  -- Auto Vote Start
  if Cfg("Auto Vote Start Game", false) then
    startOnce("vote_start", function()
      local r = R_Voting:WaitForChild("VotePlaying")
      while (_G.TekkitConfig and _G.TekkitConfig["Auto Vote Start Game"]) do
        pcall(function() r:FireServer() end)
        task.wait(5)
      end
    end)
  end

  -- Auto Upgrade
  if Cfg("Auto Upgrade", false) then
    startOnce("upgrade", function()
      local uf = LocalPlayer:WaitForChild("UnitsFolder")
      while (_G.TekkitConfig and _G.TekkitConfig["Auto Upgrade"]) do
        for _, u in ipairs(uf:GetChildren()) do
          pcall(function() R_Units:WaitForChild("Upgrade"):FireServer(u) end)
          task.wait(0.1)
        end
        task.wait(5)
      end
    end)
  end

  -- Auto Use Speed
  if Cfg("Auto Use Speed", false) then
    startOnce("speed", function()
      local tier = clamp(tonumber(Cfg("Speed Gamepass Tier",1)) or 1, 1, 3)
      local spd = Remote:WaitForChild("SpeedGamepass")
      while (_G.TekkitConfig and _G.TekkitConfig["Auto Use Speed"]) do
        pcall(function() spd:FireServer(tier) end)
        task.wait(5)
      end
    end)
  end

  -- Vote loops: Next / Replay / Leave
  local function voteLoop(cfgKey, rName)
    if Cfg(cfgKey,false) then
      startOnce(rName, function()
        local r = R_Voting:WaitForChild(rName)
        while (_G.TekkitConfig and _G.TekkitConfig[cfgKey]) do
          pcall(function() r:FireServer() end)
          task.wait(5)
        end
      end)
    end
  end
  voteLoop("Auto Vote Next", "VoteNext")
  voteLoop("Auto Replay",    "VoteRetry")
  voteLoop("Auto Leave",     "VoteLeave")

  -- Player Only
  if Cfg("Player Only", false) then
    startOnce("player_only", function()
      while (_G.TekkitConfig and _G.TekkitConfig["Player Only"]) do
        if #Players:GetPlayers() > 1 then
          warn("üë• ‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‚Üí Rejoining...")
          TeleportService:Teleport(game.PlaceId, LocalPlayer)
          break
        end
        task.wait(3)
      end
    end)
  end
end)
